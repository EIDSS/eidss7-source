@using EIDSS.Domain.ResponseModels.Administration
@using EIDSS.Web.ViewModels.Human
@using EIDSS.Web.Components.CrossCutting

@inherits EIDSS.Web.Components.Human.HumanDiseaseReport.DiseaseReportSampleAddModalBase

<RadzenTemplateForm id="humanDiseaseReportAddSamplesForm" @ref="_form" TItem="DiseaseReportSamplePageSampleDetailViewModel" Data="@sampleDetailModel" Context="AddSampleDetail" Submit="@HandleValidSamplesSubmit" OnInvalidSubmit="@HandleInvalidSamplesSubmit">
    <div class="card">
        <div class="card-header">
        </div>
        <div class="card-body">
            <div class="form-row">
                <input type="hidden" id="RowID" value="@sampleDetailModel.RowID" />
                <input type="hidden" id="TempLocalSampleID" value="@sampleDetailModel.TempLocalSampleID" />
                <InterfaceEditorResource InterfaceEditorKey="@FieldLabelResourceKeyConstants.HumanDiseaseReportFilterSampleByDiseaseFieldLabel" IsRow="false" CssClass="col-md-6" For="FilterSampleByDisease">
                    <RadzenCheckBox @bind-Value="@sampleDetailModel.FilterSampleByDisease" TValue="bool?" Change="@(LoadSampleTypes)" Disabled="@IsReportClosed"></RadzenCheckBox>
                </InterfaceEditorResource>
            </div>
            <div class="form-row">
                <InterfaceEditorResource InterfaceEditorKey="@FieldLabelResourceKeyConstants.HumanDiseaseReportSampleTypeFieldLabel" IsRow="false" CssClass="col-md-6" For="SampleTypeDD">
                    <RadzenDropDown AllowClear="true" AllowFiltering="true" FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive" Name="SampleTypeDD" TValue="long?" Data="@sampleTypes" ValueProperty="idfsBaseReference"
                                    TextProperty="StrDefault" @bind-Value="@sampleDetailModel.SampleTypeID" Count="@SampleCount" class="form-control"
                                    Change="@(UpdateSampleTypeName)" Disabled="@IsReportClosed"></RadzenDropDown>
                </InterfaceEditorResource>
                <InterfaceEditorResource InterfaceEditorKey="@FieldLabelResourceKeyConstants.HumanDiseaseReportLocalSampleIDFieldLabel" IsRow="false" CssClass="col-md-6" For="LocalSampleId">
                    <RadzenTextBox @bind-Value="@sampleDetailModel.LocalSampleId" class="form-control" Disabled="@IsReportClosed"></RadzenTextBox>
                </InterfaceEditorResource>
            </div>
        </div>
        <div class="form-row">
            <InterfaceEditorResource InterfaceEditorKey="@FieldLabelResourceKeyConstants.HumanDiseaseReportCollectionDateFieldLabel" IsRow="false" CssClass="col-md-4" For="CollectionDate">
                <RadzenDatePicker id="Samples_CollectionDate" Name="Samples_CollectionDate" AllowClear="true" AllowInput="true" class="form-control-range" TValue="DateTime?"
                                  @bind-Value="@sampleDetailModel.CollectionDate" DateFormat="d" Disabled="@IsReportClosed" />
                <RadzenCompareValidator Value="@sampleDetailModel.SymptomsOnsetDate" Component="Samples_CollectionDate" Popup="false" Operator="CompareOperator.GreaterThanEqual"
                                        Text="@string.Format(Localizer.GetString(MessageResourceKeyConstants.Date2MustBeSameOrLaterThanDate1Message), Localizer.GetString(FieldLabelResourceKeyConstants.HumanDiseaseReportSymptomsDateOfSymptomsOnsetFieldLabel), Localizer.GetString(FieldLabelResourceKeyConstants.HumanDiseaseReportCollectionDateFieldLabel))"
                                        Style="display: block" />
                <RadzenCompareValidator Value="@DateTime.Now" Component="Samples_CollectionDate" Popup="false" Operator="CompareOperator.LessThanEqual"
                                        Text="@Localizer.GetString(MessageResourceKeyConstants.FutureDatesAreNotAllowedMessage)"
                                        Style="display: block" />
            </InterfaceEditorResource>
            <InterfaceEditorResource InterfaceEditorKey="@FieldLabelResourceKeyConstants.HumanDiseaseReportCollectedByInstitutionFieldLabel" IsRow="false" CssClass="col-md-4" For="CollectedByOrganizationID">
                <RadzenDropDown TValue="long?" AllowFiltering="true" FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive" AllowClear="true" AllowSorting="true" Data="@collectedByInstitution"
                                LoadData="@LoadCollectedByInstitution" ValueProperty="idfOffice" TextProperty="name" @bind-Value="@sampleDetailModel.CollectedByOrganizationID"
                                Count="@CollectedByInstitutionCount" class="form-control" Change="@(args => UpdateCollectedByOrganizationName(args))" Disabled="@IsReportClosed"></RadzenDropDown>
            </InterfaceEditorResource>
            <InterfaceEditorResource InterfaceEditorKey="@FieldLabelResourceKeyConstants.HumanDiseaseReportCollectedByOfficerFieldLabel" IsRow="false" CssClass="col-md-4" For="CollectedByOfficerID">
                <div class="input-group flex-nowrap">
                    <RadzenDropDown AllowFiltering="true" FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive" AllowClear="true" AllowSorting="true" TValue="long?" Data="@collectedByEmployees"
                                    LoadData="@LoadCollectedByOfficer" ValueProperty="idfPerson" TextProperty="FullName" @bind-Value="@sampleDetailModel.CollectedByOfficerID" class="form-control"
                                    Change="@(args => UpdateCollectedByOfficeName(args))" Disabled="@(EnableCollectedByOfficer || IsReportClosed)"></RadzenDropDown>
                    @if (canAddEmployee)
                    {
                        <button id="AddEmployee" type="button" @onclick=@(() => OpenEmployeeAddModal()) class="btn btn-outline-secondary btn-sm" disabled="@IsReportClosed"><span class="fas fa-plus" aria-hidden="true"></span></button>
                    }
                </div>
            </InterfaceEditorResource>


        </div>
        <div class="form-row">
            <InterfaceEditorResource InterfaceEditorKey="@FieldLabelResourceKeyConstants.HumanDiseaseReportSentDateFieldLabel" IsRow="false" CssClass="col-md-6" For="CollectedByOfficerID">
                <RadzenDatePicker id="Samples_SentDate" Name="Samples_SentDate" @bind-Value="@sampleDetailModel.SentDate" class="form-control-range" DateFormat="d" Disabled="@IsReportClosed"></RadzenDatePicker>
                <RadzenCompareValidator Value="@sampleDetailModel.CollectionDate" Component="Samples_SentDate" Popup="false" Operator="CompareOperator.GreaterThanEqual"
                                        Text="@string.Format(Localizer.GetString(MessageResourceKeyConstants.Date2MustBeSameOrLaterThanDate1Message), Localizer.GetString(FieldLabelResourceKeyConstants.HumanDiseaseReportCollectionDateFieldLabel), Localizer.GetString(FieldLabelResourceKeyConstants.HumanAggregateDiseaseReportDateSentFieldLabel))"
                                        Style="display: block" />
            </InterfaceEditorResource>
            <InterfaceEditorResource InterfaceEditorKey="@FieldLabelResourceKeyConstants.HumanDiseaseReportSentToOrganizationFieldLabel" IsRow="false" CssClass="col-md-6" For="SentToOrganizationID">
                <RadzenDropDown TValue="long?" Name="SentToOrganizationID" @bind-Value="@sampleDetailModel.SentToOrganizationID" class="form-control" LoadData="@LoadSentToInstitution"
                                AllowFiltering="true" FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive" AllowClear="true" TextProperty="name" ValueProperty="idfOffice"
                                Data="@sentToInstitutions" Change="@(args => UpdateSentByName(args))" Disabled="@IsReportClosed"></RadzenDropDown>
            </InterfaceEditorResource>
        </div>
        <div class="form-row">
            <InterfaceEditorResource InterfaceEditorKey="@FieldLabelResourceKeyConstants.HumanDiseaseReportAccessionDateFieldLabel" IsRow="false" CssClass="col-md-6" For="AccessionDate">
                <RadzenDatePicker @bind-Value="@sampleDetailModel.AccessionDate" class="form-control-range" DateFormat="d" ReadOnly="true" Disabled="@IsReportClosed"></RadzenDatePicker>
            </InterfaceEditorResource>
            <InterfaceEditorResource InterfaceEditorKey="@FieldLabelResourceKeyConstants.HumanDiseaseReportSampleConditionReceivedFieldLabel" IsRow="false" CssClass="col-md-6" For="SampleConditionRecieved">
                <RadzenTextArea @bind-Value="@sampleDetailModel.SampleConditionRecieved" class="form-control" ReadOnly="true" Disabled="@IsReportClosed"></RadzenTextArea>
            </InterfaceEditorResource>
        </div>
    </div>
    <div class="card-footer">
        <button type="button" class="btn btn-secondary"
                @onclick="((args) => DiagService.Close(null))">
            @Localizer.GetString(ButtonResourceKeyConstants.CancelButton)
        </button>

        <button type="submit" class="btn btn-primary" Disabled="@IsReportClosed">
            @Localizer.GetString(ButtonResourceKeyConstants.SaveButton)
        </button>
    </div>

</RadzenTemplateForm>
