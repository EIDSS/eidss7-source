/*
Deployment script for EIDSS7_MSTR_Shell

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO


UPDATE tlbEIDSSVersionControl SET intRowStatus = 1;
INSERT INTO [dbo].[tlbEIDSSVersionControl]
           ([ApplicationVersion]
           ,[DatabaseVersion]
           ,[Ver_Start_Timestamp]
           ,[Ver_End_Timestamp]
           ,[intRowStatus])
     VALUES
           ('7.0.335.6',
           '7.0.335.6',
           GETDATE(),
           DATEADD(DAY, 365, GETDATE()),
           0);
GO 

/*
The column [dbo].[trtReferenceType].[EditorSettings] is being dropped, data loss could occur.
*/

IF EXISTS (select top 1 1 from [dbo].[trtReferenceType])
    RAISERROR (N'Rows were detected. The schema update is terminating because data loss might occur.', 16, 127) WITH NOWAIT

GO
PRINT N'Dropping Default Constraint [dbo].[DF__tlbReport__Gener__3D166914]...';


GO
ALTER TABLE [dbo].[tlbReportAudit] DROP CONSTRAINT [DF__tlbReport__Gener__3D166914];


GO
PRINT N'Dropping Default Constraint [dbo].[DF_trtSystemFunctionOperation_CreateDTM]...';


GO
ALTER TABLE [dbo].[trtSystemFunctionOperation] DROP CONSTRAINT [DF_trtSystemFunctionOperation_CreateDTM];


GO
PRINT N'Dropping Default Constraint [dbo].[DF__trtSystem__intRo__2706EE0D]...';


GO
ALTER TABLE [dbo].[trtSystemFunctionOperation] DROP CONSTRAINT [DF__trtSystem__intRo__2706EE0D];


GO
PRINT N'Dropping Default Constraint [dbo].[DF__trtSystem__rowgu__27FB1246]...';


GO
ALTER TABLE [dbo].[trtSystemFunctionOperation] DROP CONSTRAINT [DF__trtSystem__rowgu__27FB1246];


GO
PRINT N'Dropping Default Constraint [dbo].[DF_tstCheckConstraints_rowguid]...';


GO
ALTER TABLE [dbo].[tstCheckConstraints] DROP CONSTRAINT [DF_tstCheckConstraints_rowguid];


GO
PRINT N'Dropping Default Constraint [dbo].[DF_tstCheckConstraints_CreateDTM]...';


GO
ALTER TABLE [dbo].[tstCheckConstraints] DROP CONSTRAINT [DF_tstCheckConstraints_CreateDTM];


GO
PRINT N'Dropping Default Constraint [dbo].[DF_tstInvalidObjects_rowguid]...';


GO
ALTER TABLE [dbo].[tstInvalidObjects] DROP CONSTRAINT [DF_tstInvalidObjects_rowguid];


GO
PRINT N'Dropping Default Constraint [dbo].[DF_tstInvalidObjects_CreateDTM]...';


GO
ALTER TABLE [dbo].[tstInvalidObjects] DROP CONSTRAINT [DF_tstInvalidObjects_CreateDTM];


GO
PRINT N'Dropping Default Constraint [Report].[DF__tlbReport__Audit__6B9C4DD3]...';


GO
ALTER TABLE [Report].[tlbReports] DROP CONSTRAINT [DF__tlbReport__Audit__6B9C4DD3];


GO
PRINT N'Dropping Default Constraint [Report].[DF__tlbReport__rowgu__6AA8299A]...';


GO
ALTER TABLE [Report].[tlbReports] DROP CONSTRAINT [DF__tlbReport__rowgu__6AA8299A];


GO
PRINT N'Dropping Default Constraint [Report].[DF__tlbReport__Audit__706102F0]...';


GO
ALTER TABLE [Report].[tlbReportStringNameTranslation] DROP CONSTRAINT [DF__tlbReport__Audit__706102F0];


GO
PRINT N'Dropping Default Constraint [Report].[DF__tlbReport__rowgu__6F6CDEB7]...';


GO
ALTER TABLE [Report].[tlbReportStringNameTranslation] DROP CONSTRAINT [DF__tlbReport__rowgu__6F6CDEB7];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_trtSystemFunctionOperation_trtBaseReference_SourceSystemNameID]...';


GO
ALTER TABLE [dbo].[trtSystemFunctionOperation] DROP CONSTRAINT [FK_trtSystemFunctionOperation_trtBaseReference_SourceSystemNameID];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_tstCheckConstraints_trtBaseReference_SourceSystemNameID]...';


GO
ALTER TABLE [dbo].[tstCheckConstraints] DROP CONSTRAINT [FK_tstCheckConstraints_trtBaseReference_SourceSystemNameID];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_tstCheckConstraints_tstCheckTables__idfCheckTable]...';


GO
ALTER TABLE [dbo].[tstCheckConstraints] DROP CONSTRAINT [FK_tstCheckConstraints_tstCheckTables__idfCheckTable];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_tstInvalidObjects_trtBaseReference_SourceSystemNameID]...';


GO
ALTER TABLE [dbo].[tstInvalidObjects] DROP CONSTRAINT [FK_tstInvalidObjects_trtBaseReference_SourceSystemNameID];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_gisWHOMap_trtBaseReference_SourceSystemNameID]...';


GO
ALTER TABLE [dbo].[gisWHOMap] DROP CONSTRAINT [FK_gisWHOMap_trtBaseReference_SourceSystemNameID];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_idfsLocation_gisLocation]...';


GO
ALTER TABLE [dbo].[gisWHOMap] DROP CONSTRAINT [FK_idfsLocation_gisLocation];


GO

GO
PRINT N'Starting rebuilding table [dbo].[tauApplicationEventLog]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_tauApplicationEventLog] (
    [Id]              BIGINT         IDENTITY (1, 1) NOT NULL,
    [Message]         NVARCHAR (MAX) NULL,
    [MessageTemplate] NVARCHAR (MAX) NULL,
    [Level]           NVARCHAR (128) NULL,
    [TimeStamp]       DATETIME       NOT NULL,
    [Exception]       NVARCHAR (MAX) NULL,
    [Properties]      NVARCHAR (MAX) NULL,
    [UserName]        NVARCHAR (200) NULL,
    [IP]              VARCHAR (200)  NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_tauApplicationEventLog1] PRIMARY KEY CLUSTERED ([Id] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[tauApplicationEventLog])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_tauApplicationEventLog] ON;
        INSERT INTO [dbo].[tmp_ms_xx_tauApplicationEventLog] ([Id], [Message], [MessageTemplate], [Level], [TimeStamp], [Exception], [Properties], [UserName], [IP])
        SELECT   [Id],
                 [Message],
                 [MessageTemplate],
                 [Level],
                 [TimeStamp],
                 [Exception],
                 [Properties],
                 [UserName],
                 [IP]
        FROM     [dbo].[tauApplicationEventLog]
        ORDER BY [Id] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_tauApplicationEventLog] OFF;
    END

DROP TABLE [dbo].[tauApplicationEventLog];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_tauApplicationEventLog]', N'tauApplicationEventLog';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_tauApplicationEventLog1]', N'PK_tauApplicationEventLog', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[tlbReportAudit]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_tlbReportAudit] (
    [idfReportAudit]      BIGINT         IDENTITY (1, 1) NOT NULL,
    [idfUserID]           BIGINT         NOT NULL,
    [FirstName]           NVARCHAR (256) NULL,
    [MiddleName]          NVARCHAR (256) NULL,
    [LastName]            NVARCHAR (256) NULL,
    [UserRole]            NVARCHAR (256) NULL,
    [Organization]        NVARCHAR (256) NOT NULL,
    [ReportName]          NVARCHAR (256) NULL,
    [IsSignatureIncluded] BIT            NULL,
    [GeneratedDate]       DATETIME       CONSTRAINT [DF__tlbReport__Gener__3D166914] DEFAULT (getdate()) NOT NULL,
    CONSTRAINT [tmp_ms_xx_constraint_XPKtlbReportsAudit1] PRIMARY KEY CLUSTERED ([idfReportAudit] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[tlbReportAudit])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_tlbReportAudit] ON;
        INSERT INTO [dbo].[tmp_ms_xx_tlbReportAudit] ([idfReportAudit], [idfUserID], [FirstName], [MiddleName], [LastName], [UserRole], [Organization], [ReportName], [IsSignatureIncluded], [GeneratedDate])
        SELECT   [idfReportAudit],
                 [idfUserID],
                 [FirstName],
                 [MiddleName],
                 [LastName],
                 [UserRole],
                 [Organization],
                 [ReportName],
                 [IsSignatureIncluded],
                 [GeneratedDate]
        FROM     [dbo].[tlbReportAudit]
        ORDER BY [idfReportAudit] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_tlbReportAudit] OFF;
    END

DROP TABLE [dbo].[tlbReportAudit];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_tlbReportAudit]', N'tlbReportAudit';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_XPKtlbReportsAudit1]', N'XPKtlbReportsAudit', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Altering Table [dbo].[trtReferenceType]...';


GO
ALTER TABLE [dbo].[trtReferenceType] DROP COLUMN [EditorSettings];


GO
PRINT N'Starting rebuilding table [dbo].[trtSystemFunctionOperation]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_trtSystemFunctionOperation] (
    [idfsSystemFunctionOperation] BIGINT           IDENTITY (1, 1) NOT NULL,
    [idfsObjectType]              BIGINT           NULL,
    [idfsObjectTypeName]          VARCHAR (200)    NULL,
    [idfsObjectOperation]         BIGINT           NULL,
    [idfsObjectOperationnName]    VARCHAR (200)    NULL,
    [idfsObjectID]                BIGINT           NULL,
    [idfsObjectIDName]            VARCHAR (200)    NULL,
    [strReservedAttribute]        NVARCHAR (MAX)   NULL,
    [intRowStatus]                INT              CONSTRAINT [DF__trtSystem__intRo__2706EE0D] DEFAULT ((0)) NOT NULL,
    [rowguid]                     UNIQUEIDENTIFIER CONSTRAINT [DF__trtSystem__rowgu__27FB1246] DEFAULT (newid()) ROWGUIDCOL NOT NULL,
    [SourceSystemNameID]          BIGINT           NULL,
    [SourceSystemKeyValue]        NVARCHAR (MAX)   NULL,
    [AuditCreateUser]             NVARCHAR (200)   NULL,
    [AuditCreateDTM]              DATETIME         CONSTRAINT [DF_trtSystemFunctionOperation_CreateDTM] DEFAULT (getdate()) NULL,
    [AuditUpdateUser]             NVARCHAR (200)   NULL,
    [AuditUpdateDTM]              DATETIME         NULL,
    CONSTRAINT [tmp_ms_xx_constraint_XPKtrtSystemFunctionOperation1] PRIMARY KEY CLUSTERED ([idfsSystemFunctionOperation] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[trtSystemFunctionOperation])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_trtSystemFunctionOperation] ON;
        INSERT INTO [dbo].[tmp_ms_xx_trtSystemFunctionOperation] ([idfsSystemFunctionOperation], [idfsObjectType], [idfsObjectTypeName], [idfsObjectOperation], [idfsObjectOperationnName], [idfsObjectID], [idfsObjectIDName], [strReservedAttribute], [intRowStatus], [rowguid], [SourceSystemNameID], [SourceSystemKeyValue], [AuditCreateUser], [AuditCreateDTM], [AuditUpdateUser], [AuditUpdateDTM])
        SELECT   [idfsSystemFunctionOperation],
                 [idfsObjectType],
                 [idfsObjectTypeName],
                 [idfsObjectOperation],
                 [idfsObjectOperationnName],
                 [idfsObjectID],
                 [idfsObjectIDName],
                 [strReservedAttribute],
                 [intRowStatus],
                 [rowguid],
                 [SourceSystemNameID],
                 [SourceSystemKeyValue],
                 [AuditCreateUser],
                 [AuditCreateDTM],
                 [AuditUpdateUser],
                 [AuditUpdateDTM]
        FROM     [dbo].[trtSystemFunctionOperation]
        ORDER BY [idfsSystemFunctionOperation] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_trtSystemFunctionOperation] OFF;
    END

DROP TABLE [dbo].[trtSystemFunctionOperation];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_trtSystemFunctionOperation]', N'trtSystemFunctionOperation';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_XPKtrtSystemFunctionOperation1]', N'XPKtrtSystemFunctionOperation', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[tstCheckConstraints]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_tstCheckConstraints] (
    [idfCheckConstraints]    BIGINT           IDENTITY (1, 1) NOT NULL,
    [idfCheckTable]          BIGINT           NULL,
    [strConstraintName]      NVARCHAR (500)   NOT NULL,
    [strTableName1]          NVARCHAR (500)   NOT NULL,
    [strColumnName1]         NVARCHAR (500)   NOT NULL,
    [strTableName2]          NVARCHAR (500)   NULL,
    [strColumnName2]         NVARCHAR (500)   NULL,
    [strAdditionalParameter] NVARCHAR (500)   NULL,
    [strAdditionalJoin]      NVARCHAR (2000)  NULL,
    [strMandatoryFieldAlias] NVARCHAR (500)   NULL,
    [strFixQueryTemplate]    NVARCHAR (MAX)   NULL,
    [blnCanAutoFix]          BIT              NULL,
    [rowguid]                UNIQUEIDENTIFIER CONSTRAINT [DF_tstCheckConstraints_rowguid] DEFAULT (newsequentialid()) ROWGUIDCOL NOT NULL,
    [SourceSystemNameID]     BIGINT           NULL,
    [SourceSystemKeyValue]   NVARCHAR (MAX)   NULL,
    [AuditCreateUser]        NVARCHAR (200)   NULL,
    [AuditCreateDTM]         DATETIME         CONSTRAINT [DF_tstCheckConstraints_CreateDTM] DEFAULT (getdate()) NULL,
    [AuditUpdateUser]        NVARCHAR (200)   NULL,
    [AuditUpdateDTM]         DATETIME         NULL,
    CONSTRAINT [tmp_ms_xx_constraint_XPKtstCheckConstraints1] PRIMARY KEY CLUSTERED ([idfCheckConstraints] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[tstCheckConstraints])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_tstCheckConstraints] ON;
        INSERT INTO [dbo].[tmp_ms_xx_tstCheckConstraints] ([idfCheckConstraints], [idfCheckTable], [strConstraintName], [strTableName1], [strColumnName1], [strTableName2], [strColumnName2], [strAdditionalParameter], [strAdditionalJoin], [strMandatoryFieldAlias], [strFixQueryTemplate], [blnCanAutoFix], [rowguid], [SourceSystemNameID], [SourceSystemKeyValue], [AuditCreateUser], [AuditCreateDTM], [AuditUpdateUser], [AuditUpdateDTM])
        SELECT   [idfCheckConstraints],
                 [idfCheckTable],
                 [strConstraintName],
                 [strTableName1],
                 [strColumnName1],
                 [strTableName2],
                 [strColumnName2],
                 [strAdditionalParameter],
                 [strAdditionalJoin],
                 [strMandatoryFieldAlias],
                 [strFixQueryTemplate],
                 [blnCanAutoFix],
                 [rowguid],
                 [SourceSystemNameID],
                 [SourceSystemKeyValue],
                 [AuditCreateUser],
                 [AuditCreateDTM],
                 [AuditUpdateUser],
                 [AuditUpdateDTM]
        FROM     [dbo].[tstCheckConstraints]
        ORDER BY [idfCheckConstraints] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_tstCheckConstraints] OFF;
    END

DROP TABLE [dbo].[tstCheckConstraints];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_tstCheckConstraints]', N'tstCheckConstraints';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_XPKtstCheckConstraints1]', N'XPKtstCheckConstraints', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Altering Table [dbo].[tstEventActive]...';


GO
ALTER TABLE [dbo].[tstEventActive] ALTER COLUMN [intRowNum] DROP NOT FOR REPLICATION;


GO
PRINT N'Starting rebuilding table [dbo].[tstInvalidObjects]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_tstInvalidObjects] (
    [idfKey]               INT              IDENTITY (1, 1) NOT NULL,
    [strProblemName]       VARCHAR (200)    NOT NULL,
    [strRootObjectName]    VARCHAR (200)    NOT NULL,
    [idfRootObjectID]      BIGINT           NOT NULL,
    [strRootObjectID]      VARCHAR (500)    NULL,
    [strInvalidTableName]  VARCHAR (200)    NOT NULL,
    [idfInvalidObjectID]   BIGINT           NOT NULL,
    [strInvalidConstraint] VARCHAR (500)    NULL,
    [strInvalidFieldName]  VARCHAR (200)    NULL,
    [strInvalidFieldValue] VARCHAR (500)    NULL,
    [strSelectQuery]       VARCHAR (MAX)    NULL,
    [strFixQueryTemplate]  VARCHAR (MAX)    NULL,
    [blnCanAutoFix]        BIT              NULL,
    [blnFixed]             BIT              NULL,
    [rowguid]              UNIQUEIDENTIFIER CONSTRAINT [DF_tstInvalidObjects_rowguid] DEFAULT (newsequentialid()) ROWGUIDCOL NOT NULL,
    [SourceSystemNameID]   BIGINT           NULL,
    [SourceSystemKeyValue] NVARCHAR (MAX)   NULL,
    [AuditCreateUser]      NVARCHAR (200)   NULL,
    [AuditCreateDTM]       DATETIME         CONSTRAINT [DF_tstInvalidObjects_CreateDTM] DEFAULT (getdate()) NULL,
    [AuditUpdateUser]      NVARCHAR (200)   NULL,
    [AuditUpdateDTM]       DATETIME         NULL,
    CONSTRAINT [tmp_ms_xx_constraint_XPKtstInvalidObjects1] PRIMARY KEY CLUSTERED ([idfKey] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[tstInvalidObjects])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_tstInvalidObjects] ON;
        INSERT INTO [dbo].[tmp_ms_xx_tstInvalidObjects] ([idfKey], [strProblemName], [strRootObjectName], [idfRootObjectID], [strRootObjectID], [strInvalidTableName], [idfInvalidObjectID], [strInvalidConstraint], [strInvalidFieldName], [strInvalidFieldValue], [strSelectQuery], [strFixQueryTemplate], [blnCanAutoFix], [blnFixed], [rowguid], [SourceSystemNameID], [SourceSystemKeyValue], [AuditCreateUser], [AuditCreateDTM], [AuditUpdateUser], [AuditUpdateDTM])
        SELECT   [idfKey],
                 [strProblemName],
                 [strRootObjectName],
                 [idfRootObjectID],
                 [strRootObjectID],
                 [strInvalidTableName],
                 [idfInvalidObjectID],
                 [strInvalidConstraint],
                 [strInvalidFieldName],
                 [strInvalidFieldValue],
                 [strSelectQuery],
                 [strFixQueryTemplate],
                 [blnCanAutoFix],
                 [blnFixed],
                 [rowguid],
                 [SourceSystemNameID],
                 [SourceSystemKeyValue],
                 [AuditCreateUser],
                 [AuditCreateDTM],
                 [AuditUpdateUser],
                 [AuditUpdateDTM]
        FROM     [dbo].[tstInvalidObjects]
        ORDER BY [idfKey] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_tstInvalidObjects] OFF;
    END

DROP TABLE [dbo].[tstInvalidObjects];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_tstInvalidObjects]', N'tstInvalidObjects';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_XPKtstInvalidObjects1]', N'XPKtstInvalidObjects', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating Default Constraint unnamed constraint on [Report].[tlbReports]...';


GO
ALTER TABLE [Report].[tlbReports]
    ADD DEFAULT (newid()) FOR [rowguid];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Report].[tlbReports]...';


GO
ALTER TABLE [Report].[tlbReports]
    ADD DEFAULT (getdate()) FOR [AuditCreateDTM];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Report].[tlbReportStringNameTranslation]...';


GO
ALTER TABLE [Report].[tlbReportStringNameTranslation]
    ADD DEFAULT (newid()) FOR [rowguid];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Report].[tlbReportStringNameTranslation]...';


GO
ALTER TABLE [Report].[tlbReportStringNameTranslation]
    ADD DEFAULT (getdate()) FOR [AuditCreateDTM];


GO
PRINT N'Creating Foreign Key [dbo].[FK_trtSystemFunctionOperation_trtBaseReference_SourceSystemNameID]...';


GO
ALTER TABLE [dbo].[trtSystemFunctionOperation] WITH NOCHECK
    ADD CONSTRAINT [FK_trtSystemFunctionOperation_trtBaseReference_SourceSystemNameID] FOREIGN KEY ([SourceSystemNameID]) REFERENCES [dbo].[trtBaseReference] ([idfsBaseReference]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_tstCheckConstraints_trtBaseReference_SourceSystemNameID]...';


GO
ALTER TABLE [dbo].[tstCheckConstraints] WITH NOCHECK
    ADD CONSTRAINT [FK_tstCheckConstraints_trtBaseReference_SourceSystemNameID] FOREIGN KEY ([SourceSystemNameID]) REFERENCES [dbo].[trtBaseReference] ([idfsBaseReference]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_tstCheckConstraints_tstCheckTables__idfCheckTable]...';


GO
ALTER TABLE [dbo].[tstCheckConstraints] WITH NOCHECK
    ADD CONSTRAINT [FK_tstCheckConstraints_tstCheckTables__idfCheckTable] FOREIGN KEY ([idfCheckTable]) REFERENCES [dbo].[tstCheckTables] ([idfCheckTable]) NOT FOR REPLICATION;


GO
PRINT N'Creating Foreign Key [dbo].[FK_tstInvalidObjects_trtBaseReference_SourceSystemNameID]...';


GO
ALTER TABLE [dbo].[tstInvalidObjects] WITH NOCHECK
    ADD CONSTRAINT [FK_tstInvalidObjects_trtBaseReference_SourceSystemNameID] FOREIGN KEY ([SourceSystemNameID]) REFERENCES [dbo].[trtBaseReference] ([idfsBaseReference]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_gisWHOMap_trtBaseReference_SourceSystemNameID]...';


GO
ALTER TABLE [dbo].[gisWHOMap] WITH NOCHECK
    ADD CONSTRAINT [FK_gisWHOMap_trtBaseReference_SourceSystemNameID] FOREIGN KEY ([SourceSystemNameID]) REFERENCES [dbo].[trtBaseReference] ([idfsBaseReference]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_idfsLocation_gisLocation]...';


GO
ALTER TABLE [dbo].[gisWHOMap] WITH NOCHECK
    ADD CONSTRAINT [FK_idfsLocation_gisLocation] FOREIGN KEY ([idfsLocation]) REFERENCES [dbo].[gisLocation] ([idfsLocation]) NOT FOR REPLICATION;


GO
PRINT N'Creating Trigger [dbo].[TR_trtSystemFunctionOperation_A_Update]...';


GO

CREATE TRIGGER [dbo].[TR_trtSystemFunctionOperation_A_Update] ON [dbo].[trtSystemFunctionOperation]
FOR UPDATE
NOT FOR REPLICATION
AS
BEGIN

	IF (dbo.FN_GBL_TriggersWork() = 1 AND UPDATE([idfsSystemFunctionOperation]))  -- update to Primary Key is not allowed.
	BEGIN
		RAISERROR('Update Trigger: Not allowed to update PK.',16,1);
		ROLLBACK TRANSACTION;
	END

END
GO
PRINT N'Creating Trigger [dbo].[TR_tstCheckConstraints_A_Update]...';


GO

CREATE TRIGGER [dbo].[TR_tstCheckConstraints_A_Update] ON [dbo].[tstCheckConstraints]
FOR UPDATE
NOT FOR REPLICATION
AS
BEGIN

	IF (dbo.FN_GBL_TriggersWork() = 1 AND UPDATE([idfCheckConstraints]))  -- update to Primary Key is not allowed.
	BEGIN
		RAISERROR('Update Trigger: Not allowed to update PK.',16,1);
		ROLLBACK TRANSACTION;
	END

END
GO
PRINT N'Creating Trigger [dbo].[TR_tstInvalidObjects_A_Update]...';


GO

CREATE TRIGGER [dbo].[TR_tstInvalidObjects_A_Update] ON [dbo].[tstInvalidObjects]
FOR UPDATE
NOT FOR REPLICATION
AS
BEGIN

	IF (dbo.FN_GBL_TriggersWork() = 1 AND UPDATE([idfKey]))  -- update to Primary Key is not allowed.
	BEGIN
		RAISERROR('Update Trigger: Not allowed to update PK.',16,1);
		ROLLBACK TRANSACTION;
	END

END
GO
PRINT N'Refreshing Function [dbo].[FN_ADMIN_STAT_GetList]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[FN_ADMIN_STAT_GetList]';


GO
PRINT N'Refreshing Function [dbo].[fn_Statistic_SelectList]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[fn_Statistic_SelectList]';


GO
PRINT N'Refreshing Function [dbo].[fn_GetRayonStatInfo]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[fn_GetRayonStatInfo]';


GO
PRINT N'Refreshing Procedure [dbo].[USP_REP_REPORT_AUDIT_SET]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[USP_REP_REPORT_AUDIT_SET]';


GO
PRINT N'Refreshing Procedure [dbo].[USP_REP_Reports_GetList]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[USP_REP_Reports_GetList]';


GO
PRINT N'Refreshing Procedure [Report].[USP_REP_Administrative_Report_Audit_Log]...';


GO
EXECUTE sp_refreshsqlmodule N'[Report].[USP_REP_Administrative_Report_Audit_Log]';


GO
PRINT N'Refreshing Procedure [Report].[USP_REP_Reports_GetList]...';


GO
EXECUTE sp_refreshsqlmodule N'[Report].[USP_REP_Reports_GetList]';


GO
PRINT N'Refreshing Procedure [dbo].[USP_GBL_LKUP_Diseases_BY_IDS_GETLIST_Paged]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[USP_GBL_LKUP_Diseases_BY_IDS_GETLIST_Paged]';


GO
PRINT N'Refreshing Procedure [dbo].[USP_GBL_BASE_REFERENCEBYNAMES_GETList]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[USP_GBL_BASE_REFERENCEBYNAMES_GETList]';


GO
PRINT N'Refreshing Procedure [dbo].[USP_GBL_LKUP_REFERENCETYPE_BY_IDS_GETLIST]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[USP_GBL_LKUP_REFERENCETYPE_BY_IDS_GETLIST]';


GO
PRINT N'Refreshing Procedure [dbo].[USP_ADMIN_STAT_GetDetail]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[USP_ADMIN_STAT_GetDetail]';


GO
PRINT N'Refreshing Procedure [dbo].[USP_ADMIN_SYSTEMEVENTS_LOG_GetList]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[USP_ADMIN_SYSTEMEVENTS_LOG_GetList]';


GO
PRINT N'Refreshing Procedure [dbo].[USP_GBL_LKUP_BaseRef_GetList]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[USP_GBL_LKUP_BaseRef_GetList]';


GO
PRINT N'Refreshing Procedure [dbo].[USP_GBL_BASE_REFERENCE_Advanced_GETList]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[USP_GBL_BASE_REFERENCE_Advanced_GETList]';


GO
PRINT N'Refreshing Procedure [dbo].[USP_GBL_LKUP_REFERENCETYPE_BY_IDS_GETLIST_Paged]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[USP_GBL_LKUP_REFERENCETYPE_BY_IDS_GETLIST_Paged]';


GO
PRINT N'Refreshing Procedure [dbo].[USP_GBL_BASE_REFERENCE_GETBatchList]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[USP_GBL_BASE_REFERENCE_GETBatchList]';


GO
PRINT N'Refreshing Procedure [dbo].[USP_ADMIN_STAT_GetList]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[USP_ADMIN_STAT_GetList]';


GO
PRINT N'Refreshing Procedure [Report].[USP_GBL_LKUP_BaseRef_GetList]...';


GO
EXECUTE sp_refreshsqlmodule N'[Report].[USP_GBL_LKUP_BaseRef_GetList]';


GO
PRINT N'Refreshing Procedure [dbo].[USP_ADMIN_SYSTEMFUNCTION_GETLIST]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[USP_ADMIN_SYSTEMFUNCTION_GETLIST]';


GO
PRINT N'Refreshing Procedure [dbo].[USP_GBL_BASE_REFERENCE_GETList]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[USP_GBL_BASE_REFERENCE_GETList]';


GO
PRINT N'Refreshing Procedure [dbo].[USP_ADMIN_CHILDTABLESUSAGE_GET]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[USP_ADMIN_CHILDTABLESUSAGE_GET]';


GO
PRINT N'Refreshing Procedure [dbo].[USP_ADMIN_Employee_Permissions_GetList]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[USP_ADMIN_Employee_Permissions_GetList]';


GO
PRINT N'Refreshing Procedure [dbo].[USP_ADMIN_FF_Determinants_GET]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[USP_ADMIN_FF_Determinants_GET]';


GO
PRINT N'Refreshing Procedure [dbo].[USP_ADMIN_FF_ParameterReferenceTypes_GETList]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[USP_ADMIN_FF_ParameterReferenceTypes_GETList]';


GO
PRINT N'Refreshing Procedure [dbo].[USP_ADMIN_FF_TemplateDeterminantValues_GET]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[USP_ADMIN_FF_TemplateDeterminantValues_GET]';


GO
PRINT N'Refreshing Procedure [dbo].[USP_ADMIN_LKUP_ReferenceType_GETLIST]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[USP_ADMIN_LKUP_ReferenceType_GETLIST]';


GO
PRINT N'Refreshing Procedure [dbo].[USP_ASPNetUser_GetRolesAndPermissions]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[USP_ASPNetUser_GetRolesAndPermissions]';


GO
PRINT N'Refreshing Procedure [dbo].[USP_ASPNetUser_GetRolesAndPermissionsByOrg]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[USP_ASPNetUser_GetRolesAndPermissionsByOrg]';


GO
PRINT N'Refreshing Procedure [dbo].[USP_GBL_LKUP_REFERENCETYPE_FILTERED_PAGED_GETLIST]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[USP_GBL_LKUP_REFERENCETYPE_FILTERED_PAGED_GETLIST]';


GO
PRINT N'Refreshing Procedure [dbo].[USP_GBL_LKUP_REFERENCETYPE_GETLIST]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[USP_GBL_LKUP_REFERENCETYPE_GETLIST]';


GO
PRINT N'Refreshing Procedure [dbo].[USP_REF_AGEGROUP_DOESEXIST]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[USP_REF_AGEGROUP_DOESEXIST]';


GO
PRINT N'Refreshing Procedure [dbo].[USP_REF_BASEREFERENCE_DEL]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[USP_REF_BASEREFERENCE_DEL]';


GO
PRINT N'Refreshing Procedure [dbo].[USP_REF_CASECLASSIFICATION_DOESEXIST]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[USP_REF_CASECLASSIFICATION_DOESEXIST]';


GO
PRINT N'Refreshing Procedure [dbo].[USP_REF_DIAGNOSISREFERENCE_DOESEXIST]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[USP_REF_DIAGNOSISREFERENCE_DOESEXIST]';


GO
PRINT N'Refreshing Procedure [dbo].[USP_REF_MEASURELIST_DOESEXIST]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[USP_REF_MEASURELIST_DOESEXIST]';


GO
PRINT N'Refreshing Procedure [dbo].[USP_REF_MEASURELIST_GETList]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[USP_REF_MEASURELIST_GETList]';


GO
PRINT N'Refreshing Procedure [dbo].[USP_REF_REPORTDIAGNOSISGROUP_DOESEXIST]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[USP_REF_REPORTDIAGNOSISGROUP_DOESEXIST]';


GO
PRINT N'Refreshing Procedure [dbo].[USP_REF_SAMPLETYPEREFERENCE_DOESEXIST]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[USP_REF_SAMPLETYPEREFERENCE_DOESEXIST]';


GO
PRINT N'Refreshing Procedure [dbo].[USP_REF_SPECIESTYPE_DOESEXIST]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[USP_REF_SPECIESTYPE_DOESEXIST]';


GO
PRINT N'Refreshing Procedure [dbo].[USP_REF_STATISTICDATATYPE_DOESEXIST]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[USP_REF_STATISTICDATATYPE_DOESEXIST]';


GO
PRINT N'Refreshing Procedure [dbo].[USP_REF_VECTORSUBTYPE_DOESEXIST]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[USP_REF_VECTORSUBTYPE_DOESEXIST]';


GO
PRINT N'Refreshing Procedure [dbo].[USP_REF_VECTORTYPE_DOESEXIST]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[USP_REF_VECTORTYPE_DOESEXIST]';


GO
PRINT N'Refreshing Procedure [dbo].[USP_ADMIN_STAT_GETCOUNT]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[USP_ADMIN_STAT_GETCOUNT]';


GO
PRINT N'Refreshing Procedure [dbo].[usp_Statistic_GetList]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[usp_Statistic_GetList]';


GO
PRINT N'Refreshing Procedure [dbo].[usp_ObjectAccess_GetDefaultUserDetail]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[usp_ObjectAccess_GetDefaultUserDetail]';


GO
PRINT N'Refreshing Procedure [dbo].[usp_ValidateForeignKeys]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[usp_ValidateForeignKeys]';


GO
PRINT N'Refreshing Procedure [dbo].[usp_ValidateKeys]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[usp_ValidateKeys]';


GO
PRINT N'Refreshing Procedure [dbo].[usp_ValidateMandatoryFields]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[usp_ValidateMandatoryFields]';


GO
PRINT N'Refreshing Procedure [dbo].[usp_Employee_ValidateForeignKeys]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[usp_Employee_ValidateForeignKeys]';


GO
PRINT N'Refreshing Procedure [dbo].[usp_HumanAggregateCase_ValidateForeignKeys]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[usp_HumanAggregateCase_ValidateForeignKeys]';


GO
PRINT N'Refreshing Procedure [dbo].[usp_HumanCase_Validate]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[usp_HumanCase_Validate]';


GO
PRINT N'Refreshing Procedure [dbo].[usp_HumanActual_ValidateMandatoryFields]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[usp_HumanActual_ValidateMandatoryFields]';


GO
PRINT N'Refreshing Procedure [dbo].[usp_Employee_Validate]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[usp_Employee_Validate]';


GO
PRINT N'Refreshing Procedure [dbo].[usp_HumanAggregateCase_Validate]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[usp_HumanAggregateCase_Validate]';


GO
PRINT N'Refreshing Procedure [dbo].[usp_Person_CanDelete]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[usp_Person_CanDelete]';


GO
PRINT N'Refreshing Procedure [dbo].[usp_HumanAggregateCase_CanDelete]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[usp_HumanAggregateCase_CanDelete]';


GO
PRINT N'Checking existing data against newly created constraints';


GO
ALTER TABLE [dbo].[trtSystemFunctionOperation] WITH CHECK CHECK CONSTRAINT [FK_trtSystemFunctionOperation_trtBaseReference_SourceSystemNameID];

ALTER TABLE [dbo].[tstCheckConstraints] WITH CHECK CHECK CONSTRAINT [FK_tstCheckConstraints_trtBaseReference_SourceSystemNameID];

ALTER TABLE [dbo].[tstCheckConstraints] WITH CHECK CHECK CONSTRAINT [FK_tstCheckConstraints_tstCheckTables__idfCheckTable];

ALTER TABLE [dbo].[tstInvalidObjects] WITH CHECK CHECK CONSTRAINT [FK_tstInvalidObjects_trtBaseReference_SourceSystemNameID];

ALTER TABLE [dbo].[gisWHOMap] WITH CHECK CHECK CONSTRAINT [FK_gisWHOMap_trtBaseReference_SourceSystemNameID];

ALTER TABLE [dbo].[gisWHOMap] WITH CHECK CHECK CONSTRAINT [FK_idfsLocation_gisLocation];


GO
PRINT N'Update complete.';


GO
